<modification>
    <name>Add Description To Manufacturers</name>
    <code>iSellSoft-ManufacturerDescription</code>
    <version>1.0</version>
    <author>iSellSoft/ based on aPa(AlirezaPanahi@gmail.com)</author>

    <!-- Admin -->

    <file path="admin/view/template/catalog/manufacturer_form.twig">
        <operation >
            <search index="0"><![CDATA[<div class="form-group">]]></search>
            <add position="before"><![CDATA[
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-description">{{ entry_description }}</label>
	            <div class="col-sm-10">
	              <textarea name="description" placeholder="{{ entry_description }}" id="input-description">{{ description }}</textarea>
	            </div>
       		</div>
                <hr>
                <script type="text/javascript" src="view/javascript/summernote/summernote.js"></script>
                <link href="view/javascript/summernote/summernote.css" rel="stylesheet" />
                <script type="text/javascript" src="view/javascript/summernote/summernote-image-attributes.js"></script> 
                <script type="text/javascript" src="view/javascript/summernote/opencart.js"></script> 
       		<script type="text/javascript">
                    $('#input-description').summernote({height: 300});
                </script>
            ]]></add>
        </operation>
    </file>
    <file path="admin/controller/catalog/manufacturer.php">
        <operation >
            <search><![CDATA[
		if (isset($this->request->post['image'])) {
            ]]></search>
            <add position="before"><![CDATA[
                if (isset($this->request->post['description'])) {
                        $data['description'] = $this->request->post['description'];
                } elseif (!empty($manufacturer_info)) {
                        $data['description'] = $manufacturer_info['description'];
                } else {
                        $data['description'] = '';
                }
            ]]></add>
        </operation>
    </file>

    <file path="admin/model/catalog/manufacturer.php">
        <operation>
            <search><![CDATA[
		$query = $this->db->query("SELECT DISTINCT * FROM " . DB_PREFIX . "manufacturer WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
		]]></search>
            <add position="after"><![CDATA[

                if( $query->num_rows && !array_key_exists('description',$query->row) ){
                    $this->db->query("ALTER TABLE `".DB_PREFIX."manufacturer` ADD `description` TEXT NULL");
                    $query->row['description']='';
                }]]></add>
        </operation>
        <operation>
            <search><![CDATA[
		if (isset($data['image'])) {
		]]></search>
            <add position="before"><![CDATA[
                if (isset($data['description'])) {
                        $this->db->query("UPDATE " . DB_PREFIX . "manufacturer SET description = '" . $this->db->escape($data['description']) . "' WHERE manufacturer_id = '" . (int)$manufacturer_id . "'");
                }
		]]></add>
        </operation>

    </file>



    <!-- Public -->

    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[
			if ($manufacturer_info) {
            ]]></search>
            <add position="after"><![CDATA[
                            $data['description']=$manufacturer_info['description'];
            ]]></add>
        </operation>
        
    </file>
    <file path="catalog/view/theme/*/template/product/product.twig">
        <operation>
            <search><![CDATA[
            {{ description }}
            ]]></search>
            <add position="after"><![CDATA[
            {% if manufacturer_description %}
            <hr>
            {{ manufacturer_description }}
            {% endif %}
            ]]></add>
        </operation>
    </file>
    
    <file path="catalog/view/theme/*/template/product/manufacturer_info.twig">
        <operation >
            <search><![CDATA[
      <h2>{{ heading_title }}</h2>
            ]]></search>
            <add position="after"><![CDATA[
                <p>{{ description }}</p>
            ]]></add>
        </operation>

    </file>

    <file path="catalog/controller/product/manufacturer.php">
        <operation >
            <search><![CDATA[
			$data['heading_title'] = $manufacturer_info['name'];
			]]></search>
            <add position="after"><![CDATA[
                        $data['description'] =html_entity_decode($manufacturer_info['description']);
			]]></add>
        </operation>
    </file>
</modification>